---
title: Tutorial
homec: home
tutorialc: tutorial selected tutorialSelected
applicationsc: applications
miniAppsc: miniApps
downloadc: download
toolsc: tools
helpc: help
sidenav: sidenav
---

  <link rel="stylesheet" type="text/css" href="TutorialStyle.css">

  <h1>Broadcast "Hello World" Program: A Parallel "Hello World" Program</h1>

  <!-- Figure -->
   <table class="StandardFigure" align=right border=0>
    <tr><td align=center valign=middle>
      <a class="StandardFigure" href="images/BroadcastHelloWorld_ProgramFlow.jpg">
     <img class="StandardFigure" src="images/BroadcastHelloWorld_ProgramFlow_sm.jpg" border=0o alt="Figure 1: Control Flow of the Broadcast &quot;Hello World&quot; Program">
     </a>
    </td></tr>
    <tr><td align=center valign=middle>
     Figure 1: Control Flow of the Broadcast "Hello World" Program
    </td></tr>
   </table>


  <p class="BasicParagraph">
   This version of "Hello World" is basically the same as the Array "Hello World" program
   except that all of the Hello chare objects will be told to say "Hello" at the same time
   instead of each of them doing it one-by-one.  The figure to the right shows the control
   flow of the program.  The source code is located below.  Here are the differences from
   the Array "Hello World" program:
  </p>

  <ul>
   <li style="{margin-bottom:15px;}">
       <b>broadcast:</b>  In the Array "Hello World" program, the last thing the <i>Main::Main()</i>
       constructor did was tell the <i>first</i> element of the helloArray to <i>sayHi()</i>.
       In this version of "Hello World," <i>Main::Main</i> tells the <i>entire</i> array of Hello chare
       objects to <i>sayHi()</i>.  This is done by calling <i>Hello::sayHi()</i> on the array
       itself (instead of just a single element of the array).
   <li style="{margin-bottom:15px;}">
       <b>sayHi():</b>  The <i>Hello::sayHi()</i> entry method no longer has the if statement that
       tests if the object is the last object in the chare array.  Instead, every element of the
       chare arrays invokes <i>done()</i> on the Main chare object (sends a message).
   <li style="{margin-bottom:15px;}">
       <b>done():</b>  The <i>Main::done()</i> entry method is now invoked multiple times.  The
       Main chare object has a counter, <i>doneCount</i>, that counts the number of times
       <i>Main::done()</i> has been called.  Once this count reaches the number of elements in
       the Hello chare array, the program exits.
   <li style="{margin-bottom:15px;}">
       <b>numElements:</b>  Since the Main chare object is the only object that needs access
       to the numElements value, it has been made into a member variable of the Main chare class.
  </ul>

  <br clear=all>


  <h2>Broadcast "Hello World" Code</h2>

  <p class="BasicParagraph">
   The source code for this example can be found
   <a href="examples/BroadcastHelloWorld.tar.gz">here (BroadcastHelloWorld.tar.gz)</a>.
  </p>


  <h3>The "Hello" Chare Class</h3>
  <!-- Figure -->
  <center>
<div class="header" style="width:721px; margin-bottom:1px;"><a href="JavaScript:showHide('BroadcastHelloChareClass');">Show Code</a></div>
<div class="codeblock" id="BroadcastHelloChareClass" style="display:none;">
  <table>
    <tr>
      <td>
      <!-- Header File -->
      <table border=0 cellspacing=0 cellpadding=5 style="margin-bottom:1px; margin-right:1px;">
       <tr>
        <td align=center valign=middle class="header" style="width:360px;"><b>Header File <i>(hello.h)</i></b></td>
       </tr>
       <tr>
        <td align=left valign=top >

<pre class="prettyprint linenums lang-cpp" style="width:360px;">
#ifndef __HELLO_H__
#define __HELLO_H__

class Hello : public CBase_Hello {
  public:

    /// Constructors ///
    Hello();
    Hello(CkMigrateMessage *msg);

   /// Entry Methods ///
   void sayHi(int from);
};

#endif //__HELLO_H__
</pre>
         </div>
        </td>
       </tr>
      </table>
    </td>
    <td valign=top>
      <!-- Interface File -->
      <table border=0 cellspacing=0 cellpadding=5 style="margin-bottom:1px;">
       <tr>
        <td align=center valign=middle bgColor=bbbbbb class="header" style="width:360px;"><b>Interface File <i>(hello.ci)</i></b></td>
       </tr>
       <tr>
        <td align=left valign=top bgColor=bbbbbb>
<pre class="prettyprint linenums lang-ci" style="width:360px; height:304px;">
module hello {

   array [1D] Hello {
     entry Hello();
     entry void sayHi(int);
   };

 };
 </pre>
        </td>
       </tr>
      </table>
    </td>
  </tr>
</table>

      <!-- Source File -->
      <table border=0 cellspacing=0 cellpadding=5 align=center>
       <tr>
        <td align=center valign=middle bgColor=bbbbbb class="header" style="width:721px;"><b>Source File <i>(hello.C)</i></b></td>
       </tr>
       <tr>
        <td align=left valign=top bgColor=bbbbbb>
<pre class="prettyprint linenums lang-cpp" style="width:721px;">
#include "hello.decl.h"

#include "hello.h"
#include "main.decl.h"

extern /* readonly */ CProxy_Main mainProxy;

Hello::Hello() {
  // Nothing to do when the Hello chare object is created.
  // This is where member variables would be initialized
  // just like in a C++ class constructor.
}

// Constructor needed for chare object migration (ignore
// for now)
// NOTE: This constructor does not need to appear in
// the ".ci" file
Hello::Hello(CkMigrateMessage *msg) { }

void Hello ::sayHi(int from) {

  // Have this chare object say hello to the user.
  CkPrintf("\"Hello\" from Hello chare # %d on "
           "processor %d (told by %d).\n",
           thisIndex, CkMyPe(), from);

  // Report to the Main chare object that this chare object
  // has completed its task.
  mainProxy.done();
}

#include "hello.def.h"
</pre>
        </td>
       </tr>
      </table>
 <div class="header" style="width:721px; margin-top:1px;"><a href="JavaScript:showHide('BroadcastHelloChareClass');">Hide Code</a></div>
</div>
  </center>


  <h3>The "Main" Chare Class</h3>

  <!-- Figure -->
  <center>
    <div class="header" style="width:721px; margin-bottom:1px;"><a href="JavaScript:showHide('BroadcastMainChareClass');">Show Code</a></div>
    <div class="codeblock" id="BroadcastMainChareClass" style="display:none;">
      <table>
        <tr>
          <td>
          <!-- Header File -->
          <table border=0 cellspacing=0 cellpadding=5 style="margin-bottom:1px; margin-right:1px;">
           <tr>
            <td align=center valign=middle class="header" style="width:360px;"><b>Header File <i>(hello.h)</i></b></td>
           </tr>
           <tr>
            <td align=left valign=top >

    <pre class="prettyprint linenums lang-cpp" style="width:360px;">
#ifndef __MAIN_H__
#define __MAIN_H__

class Main : public CBase_Main {

 private:
  /// Member Variables (Object State) ///
  int numElements;
  int doneCount;

 public:
  /// Constructors ///
  Main(CkArgMsg* msg);
  Main(CkMigrateMessage* msg);

  /// Entry Methods ///
  void done();
};

#endif //__MAIN_H__
    </pre>
             </div>
            </td>
           </tr>
          </table>
        </td>
        <td valign=top>
          <!-- Interface File -->
          <table border=0 cellspacing=0 cellpadding=5 style="margin-bottom:1px;">
           <tr>
            <td align=center valign=middle bgColor=bbbbbb class="header" style="width:360px;"><b>Interface File <i>(hello.ci)</i></b></td>
           </tr>
           <tr>
            <td align=left valign=top bgColor=bbbbbb>
    <pre class="prettyprint linenums lang-ci" style="width:360px; height:424px;">
mainmodule main {

  readonly CProxy_Main mainProxy;

  extern module hello;

  mainchare Main {
    entry Main(CkArgMsg* msg);
    entry void done();
  };

};
     </pre>
            </td>
           </tr>
          </table>
        </td>
      </tr>
    </table>

          <!-- Source File -->
          <table border=0 cellspacing=0 cellpadding=5 align=center>
           <tr>
            <td align=center valign=middle bgColor=bbbbbb class="header" style="width:721px;"><b>Source File <i>(hello.C)</i></b></td>
           </tr>
           <tr>
            <td align=left valign=top bgColor=bbbbbb>
    <pre class="prettyprint linenums lang-cpp" style="width:721px;">
#include "main.decl.h"

#include "main.h"
#include "hello.decl.h"

/* readonly */ CProxy_Main mainProxy;

// Entry point of Charm++ application
Main::Main(CkArgMsg* msg) {

  // Initialize the local member variables
  doneCount = 0;    // Set doneCount to 0
  numElements = 5;  // Default numElements to 5

  // There should be 0 or 1 command line arguements.
  // If there is one, it is the number of "Hello"
  // chares that should be created.
  if (msg->argc > 1)
    numElements = atoi(msg->argv[1]);

  // We are done with msg so delete it.
  delete msg;

  // Display some info about this execution
  // for the user.
  CkPrintf("Running \"Hello World\" with %d elements "
           "using %d processors.\n",
           numElements, CkNumPes());

  // Set the mainProxy readonly to point to a
  // proxy for the Main chare object (this
  // chare object).
  mainProxy = thisProxy;

  // Create the array of Hello chare objects.
  CProxy_Hello helloArray = CProxy_Hello::ckNew(numElements);

  // Invoke the "sayHi()" entry method on all of the
  // elements in the helloArray array of chare objects.
  helloArray.sayHi(-1);
}

// Constructor needed for chare object migration (ignore for now)
// NOTE: This constructor does not need to appear in the ".ci" file
Main::Main(CkMigrateMessage* msg) { }

// When called, the "done()" entry method will increment the doneCount.
// Once all of the Hello chare objects have indiciated that they have
// completed their tasks, "done()" will cause the program to exit.
void Main::done() {
  // Increment the doneCount. If all of the Hello chare
  // objects have indicated that they are done, then exit.
  // Otherwise, continue waiting for the Hello chare objects.
  doneCount++;
  if (doneCount >= numElements)
    CkExit();
}

#include "main.def.h"
    </pre>
            </td>
           </tr>
          </table>
          <div class="header" style="width:721px; margin-top:1px;"><a href="JavaScript:showHide('BroadcastMainChareClass');">Hide Code</a></div>
    </div>
  </center>

  <h3>Makefile</h3>

  <p class="BasicParagraph">
   The makefile for this program is the same as it is for the Array "Hello World" program.
  </p>

  <!-- Figure -->
  <center>
    <div class="header" style="width:721px; margin-bottom:1px;"><a href="JavaScript:showHide('BroadcastMakefile');">Show Code</a></div>
    <div class="codeblock" id="BroadcastMakefile" style="display:none;">

          <!-- Makefile -->
          <table border=0 cellspacing=0 cellpadding=5 align=center>
           <tr>
            <td align=center valign=middle bgColor=bbbbbb class="header" style="width:721px;"><b>Makefile</i></b></td>
           </tr>
           <tr>
            <td align=left valign=top bgColor=bbbbbb>
    <pre class="prettyprint linenums" style="width:721px;">
CHARMDIR = [put Charm++ install directory here]
CHARMC = $(CHARMDIR)/bin/charmc $(OPTS)

default: all
all: hello

hello : main.o hello.o
  $(CHARMC) -language charm++ -o hello main.o hello.o

main.o : main.C main.h main.decl.h main.def.h hello.decl.h
  $(CHARMC) -o main.o main.C

main.decl.h main.def.h : main.ci
  $(CHARMC) main.ci

hello.o : hello.C hello.h hello.decl.h hello.def.h main.decl.h
  $(CHARMC) -o hello.o hello.C

hello.decl.h hello.def.h : hello.ci
  $(CHARMC) hello.ci

clean:
  rm -f main.decl.h main.def.h main.o
  rm -f hello.decl.h hello.def.h hello.o
  rm -f hello charmrun
    </pre>
            </td>
           </tr>
          </table>
          <div class="header" style="width:721px; margin-top:1px;"><a href="JavaScript:showHide('BroadcastMakefile');">Hide Code</a></div>
    </div>
  </center>



  <h3>Output</h3>

  <p class="BasicParagraph">
   The only difference in the output of this program and the Array "Hello World" program is
   that all of the Hello chare objects are told to <i>sayHi()</i> by the Main chare object.
   This is reflected by the fact that all the output lines below have "told by -1" in them.
  </p>

  <!-- Figure -->
  <center>
  <table border=0 cellpadding=5 cellspacing=0>

   <tr>
    <td align=left valign=middle>
     <pre class="prettyprint nocode" style="width:525px; ">

  $ ./charmrun +p3 ./hello 10
  Running "Hello World" with 10 elements using 3 processors.
  "Hello" from Hello chare # 0 on processor 0 (told by -1).
  "Hello" from Hello chare # 3 on processor 0 (told by -1).
  "Hello" from Hello chare # 6 on processor 0 (told by -1).
  "Hello" from Hello chare # 9 on processor 0 (told by -1).
  "Hello" from Hello chare # 1 on processor 1 (told by -1).
  "Hello" from Hello chare # 4 on processor 1 (told by -1).
  "Hello" from Hello chare # 7 on processor 1 (told by -1).
  "Hello" from Hello chare # 2 on processor 2 (told by -1).
  "Hello" from Hello chare # 5 on processor 2 (told by -1).
  "Hello" from Hello chare # 8 on processor 2 (told by -1).
    </pre>
    </td>
   </tr>

   <tr>
    <td align=center valign=middle>
     Figure 2: Output of the Broadcast "Hello World" Program
    </td>
   </tr>

  </table>
  </center>
